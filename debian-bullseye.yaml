image:
  distribution: debian
  release: bullseye
  architecture: amd64
  description: |
    Custom Debian LXC image for Proxmox

source:
  downloader: debootstrap
  url: http://deb.debian.org/debian
  variant: minbase

targets:
  lxc:
    create_message: "Debian LXC container created"

packages:
  manager: apt
  update: true
  sets:
    - packages:
        - openssh-server
      action: install

    - packages:
        - curl
      action: install

    - packages:
        - vim
      action: install

actions:
  - trigger: post-install
    action: |
      #!/bin/sh
      echo "Setting up SSH"
      mkdir -p /root/.ssh
      chmod 700 /root/.ssh
      cp /authorized_keys /root/.ssh/authorized_keys
      chmod 600 /root/.ssh/authorized_keys
      systemctl enable ssh
